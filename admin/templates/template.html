{% extends "base.html" %}

{% block title %}템플릿 관리{% endblock title %}
{% block subtitle %}템플릿 목록{% endblock subtitle %}

{% block content %}
    <ul id="template_list">
        {% for template in templates %}
        {% set info = get_template_info(template) %}
        <li>
            <div class="tmli_if">
            {% if info.screenshot %}
                <img src="{{ info.screenshot }}" alt="{{ info.template_name }}">
            {% else %}
                <img src="/static/admin/img/template_img.jpg" alt="">
            {% endif %}
                <div class="tmli_tit">
                    <p>{{ info.template_name }}</p>
                </div>
            </div>
            {% if config.cf_theme == info.template_dir %}
                <span class="template_sl template_sl_use">사용중</span>
                <!-- <button type="button" class="template_sl template_deactive" data-template="{{ info.template_dir }}" data-name="{{ info.template_name }}">사용안함</button> -->
            {% else %}    
                <button type="button" class="template_sl template_active" data-template="{{ info.template_dir }}" data-name="{{ info.template_name }}" data-set_default_skin="">템플릿 적용</button>
            {% endif %}
            <!-- <a href="/admin/template_preview?template={{ info.template_dir }}" class="template_pr" target="template_preview">미리보기</a> -->
            <button type="button" class="tmli_dt template_detail" data-template="{{ info.template_dir }}">상세보기</button>
        </li>
        {% else %}
            <p class="no_template">설치된 템플릿이 없습니다.</p>
        {% endfor %}
    </ul>

    <script>
    $(function() {
        $(".template_active").on("click", function() {
            var template = $(this).data("template");
            var name  = $(this).data("name");

            if(!confirm(name + " 템플릿을 적용하시겠습니까?"))
                return false;

            var set_default_skin = 0;
            if($(this).data("set_default_skin") == true) {
                if(confirm("기본환경설정, 1:1문의, 쇼핑몰 스킨을 템플릿에서 설정된 스킨으로 변경하시겠습니까?\n\n변경을 선택하시면 템플릿에서 지정된 스킨으로 회원스킨 등이 변경됩니다."))
                    set_default_skin = 1;
            }

            $.ajax({
                type: "POST",
                url: "/admin/template_update",
                data: {
                    "template": template,
                    "set_default_skin": set_default_skin
                },
                cache: false,
                success: function(response) {
                    if(response.error) {
                        alert(response.error);
                        return false;
                    }
            
                    if(response.success) {
                        alert(response.success);
                        document.location.reload();
                    }
                }
            });
        });

        $(".template_deactive").on("click", function() {
            var template = $(this).data("template");
            var name  = $(this).data("name");

            if(!confirm(name + " 템플릿 사용설정을 해제하시겠습니까?\n\n템플릿 설정을 해제하셔도 게시판 등의 스킨은 변경되지 않으므로 개별 변경작업이 필요합니다."))
                return false;

            $.ajax({
                type: "POST",
                url: "/admin/template_update",
                data: {
                    "template": template,
                    "type": "reset"
                },
                cache: false,
                async: false,
                success: function(data) {
                    if(data) {
                        alert(data);
                        return false;
                    }

                    document.location.reload();
                }
            });
        });

        $(".template_detail").on("click", function() {
            var template = $(this).data("template");

            $("#template_detail").remove();

            $.ajax({
                type: "POST",
                url: "/admin/template_detail",
                contentType: 'application/x-www-form-urlencoded',
                data: {
                    "template": template
                },
                cache: false,
                async: false,
                success: function(data) {
                    $("#template_list").after(data);
                }
            });
        });
    });    
    </script>
{% endblock content %}
